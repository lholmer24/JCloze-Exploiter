import urllib.request
import math
import sys

def JCloze1(urlinput):
	
	try:
		site = urllib.request.urlopen(urlinput) #load the site
	except:
		print('Url is not valid')
	else:
		siteStr = site.read().decode('utf-8') #convert the site to a readable html string

		if siteStr.count('[1][0][0]') > 0:

			for x in list(range(siteStr.count('[1][0][0]'))): #finds total number of questions
				location1 = int(siteStr.find('[1][0][0]')) #finds the location of the answer in the html
				cutSite = siteStr[location1 + 13:-1] 
				location2 = int(cutSite.find(';')) 
				result = siteStr[location1 + 13:location2 + location1 + 12] #gets the result
				
				results = result.split('\\u') #pulls it apart and removes the unicode tags
				results.pop(0) #removes the first empty string that will be created
				newresults = [] #makes a new list
				
				for y in results:
					newresults.append(chr(int('0x' + y, 16))) #turns the hex codes into ascii letters
				finalanswer = ''
				
				for z in newresults:
					finalanswer += z #turns the list of letters into words
				print(finalanswer) #prints the word
				
				siteStr = siteStr[location2 + location1 + 13:-1] #chops the site further so it won't repeat an answer
		else:
			print('Could not identify any JCloze1 questions')
			print('-----------------')

def JMatch1(urlinput):

	try:
		site = urllib.request.urlopen(urlinput) #load the site
	except:
		print('Url is not valid')
	else:
		siteStr = site.read().decode('utf-8') #convert the site to a readable html string

		questionNum = siteStr.count('os=\"R_') - 1

		if questionNum > 0:
			questionNum = int(math.sqrt(questionNum))
		

			for x in list(range(questionNum)):
				location1 = int(siteStr.find('os=\"R_' + str(x) + '\">'))
				siteStr = siteStr[location1 + 9: -1]
				location2 = int(siteStr.find('<'))
				print(siteStr[0:location2])
		else:
			print('Could not identify any JMatch1 questions')
			print('-----------------')


if __name__ == '__main__':


	args = sys.argv

	print('-----------------')
	print('JCloze exploiter by Laughlin Holmer')
	print('Github: lholmer24')
	print('-----------------')

	if len(args) == 1 or len(args) > 2 or args[1] == '-h' or args[1] == '--help':
		print(f'Usage: python {args[0]} [target_url]')

	else:
		urlinput = args[1]

		JCloze1(urlinput)
		JMatch1(urlinput)

	print('-----------------')